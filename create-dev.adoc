## Create DEV Deployment Environment

In this lab you will get familiar with OpenShift Web Console and OpenShift CLI and gain some experience 
interacting with an OpenShift cluster. You will also learn about deployment environments in 
software delivery lifecycle and deploy the application into these deployment environments.

#### OpenShift CLI

The first thing we want to do to ensure that the `oc` command line tools was installed and successfully 
added to your path. In order to login, you can use the `oc` command and then specify the server that you want to authenticate to. Issue the following command:

[source,shell,role=copypaste]
----
oc login {{OPENSHIFT_URL}}
----

Enter *Y* to use a potentially insecure connection. The reason you received this message is because 
we are using a self-signed certificate for this workshop, but we did not provide you with the CA 
certificate that was generated by OpenShift. In a real-world scenario, either OpenShift 
certificate would be signed by a standard CA (eg: Thawte, Verisign, StartSSL, etc.) or signed by a 
corporate-standard CA that you already have installed on your system.

Once you issue the `oc login` command, you will be prompted for the username and password 
combination for your user account. Replace XX with the username given to you by the instructor:

CAUTION: Replace `{{PROJECT_SUFFIX}}` with the number provided to you by the instructor.

* Username: `{{OPENSHIFT_USER}}`
* Password: `{{OPENSHIFT_PASSWORD}}`

Projects are a top level concept to help you organize your deployments. An OpenShift 
project allows a community of users (or a user) to organize and manage their content in 
isolation from other communities. Each project has its own resources, policies 
(who can or cannot perform actions), and constraints (quotas and limits on resources, etc). 

Projects act as a "wrapper" around all the application services and endpoints you 
(or your teams) are using for your work. You can see the list of projects 
you have access to using the following command:

[source,shell,role=copypaste]
----
oc get projects
----

There a few projects created for you in order to use during the following labs. To simplify 
using OpenShift CLI, you can specify a project as the active project which will be used 
as the default project when running OpenShift CLI commands. 

Specify the DEV project as the active project:

[source,shell,role=copypaste]
----
oc project dev{{PROJECT_SUFFIX}}
----

#### OpenShift Web Console

OpenShift ships with a web-based console that will allow users to perform various tasks via a browser. To 
get a feel for how the web console works, open your browser and go to the following URL: {{OPENSHIFT_URL}}

Since the security certificates used for securing your OpenShift cluster are self-generated and 
self-signed, your browser will not trust them by default and will show a security warning similar to the following:

image::devops-explore-cert-warning-firefox.png[Firebox Untrusted Certificate]

In Chrome browser, click on *ADVANCED* and then *Proceed to ... (unsafe)* to trust the 
certificates. In Firefox browser, click on *Advanced* button, then *Add Exception...* and then 
confirm trusting the certificate by click on *Confirm Security Exception*.

The first screen you will see is the authentication screen. Enter in the following credentials:

CAUTION: Replace `{{PROJECT_SUFFIX}}` with the number provided to you by the instructor.

* Username: `{{OPENSHIFT_USER}}`
* Password: `{{OPENSHIFT_PASSWORD}}`

image::devops-explore-web-login.png[OpenShift Login]

After you have authenticated to the web console, you will be presented with a list of 
projects that your user has permission to work with.

#### Deployment Environments

In order to deploy CoolStore application, you need the Catalog and Web UI components. The Web UI image is 
built by the front-end team and is already available in the OpenShift container registry. You can 
check the Web image in the `cicd{{PROJECT_SUFFIX}}` project by going to *Builds* > *Images*.

Deploy the Web UI into the DEV environment using the Web UI container image that is already delivered by the 
front-end team:

[source,shell,role=copypaste]
----
oc new-app -f https://raw.githubusercontent.com/{{ LABS_GITHUB_ACCOUNT }}/devops-oab-labs/master/openshift/web-template.yaml
----

The source code for the Catalog service is available in the following git repository:
http://{{GIT_HOSTNAME}}/{{GIT_USER}}/catalog-spring-boot.git

You should build a container image for the Catalog as well in order to be able to deploy it. You can 
store the Catalog image in the `cicd{{PROJECT_SUFFIX}}` project as well (similar to Web UI image) so that 
they can be re-used across various environments. 

Create an imagestream for Catalog in the `cicd{{PROJECT_SUFFIX}}` project in order to store the Catalog 
images (note the `-n` flag):

[source,shell,role=copypaste]
----
oc create -f https://raw.githubusercontent.com/{{ LABS_GITHUB_ACCOUNT }}/devops-oab-labs/master/openshift/catalog-is.yaml -n cicd{{PROJECT_SUFFIX}}
----

Now you can deploy the Catalog service into the DEV environment using a template that builds the Catalog container 
image from source code via Source-to-Image capability:

[source,shell,role=copypaste]
----
oc new-app -f https://raw.githubusercontent.com/{{ LABS_GITHUB_ACCOUNT }}/devops-oab-labs/master/openshift/catalog-template.yaml \
      --param=GIT_URI=http://{{GIT_HOSTNAME}}/{{GIT_USER}}/catalog-spring-boot.git \
      --param=MAVEN_MIRROR_URL=http://nexus.lab-infra.svc:8081/repository/maven-all-public
----


Point your browser to the Web UI route url to verify CoolStore application is deployed successfully into the 
DEV environment.
